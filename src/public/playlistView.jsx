

// temp hardcoded playlist
var playlist = {
	"id": 1,
	"created_by": "wizzler",
	"title": "Awesome playlist",
	"thumb": "some.jpg",
	"timestamp": 1234567890,
	"parent": null,
	"tags": ["rock", "pop", "electronic"],
	"collaborators": ["wizzler", "efaulte"],
	"tracks": ["5Z7ygHQo02SUrFmcgpwsKW", "1x6ACsKV4UdWS2FMuPFUiT", "4bi73jCM02fMpkI11Lqmfe"]
}

var tracks = {
  "tracks": [ {
    "album": {
      "album_type": "album",
      "external_urls": {
        "spotify": "https://open.spotify.com/album/6TJmQnO44YE5BtTxH8pop1"
      },
      "href": "https://api.spotify.com/v1/albums/6TJmQnO44YE5BtTxH8pop1",
      "id": "6TJmQnO44YE5BtTxH8pop1",
      "images": [ {
        "height": 640,
        "url": "https://d3rt1990lpmkn.cloudfront.net/original/8e13218039f81b000553e25522a7f0d7a0600f2e",
        "width": 629
      }, {
        "height": 300,
        "url": "https://d3rt1990lpmkn.cloudfront.net/original/8c1e066b5d1045038437d92815d49987f519e44f",
        "width": 295
      }, {
        "height": 64,
        "url": "https://d3rt1990lpmkn.cloudfront.net/original/d49268a8fc0768084f4750cf1647709e89a27172",
        "width": 63
      } ],
      "name": "Hot Fuss",
      "type": "album",
      "uri": "spotify:album:6TJmQnO44YE5BtTxH8pop1"
    },
    "artists": [ {
      "external_urls": {
        "spotify": "https://open.spotify.com/artist/0C0XlULifJtAgn6ZNCW2eu"
      },
      "href": "https://api.spotify.com/v1/artists/0C0XlULifJtAgn6ZNCW2eu",
      "id": "0C0XlULifJtAgn6ZNCW2eu",
      "name": "The Killers",
      "type": "artist",
      "uri": "spotify:artist:0C0XlULifJtAgn6ZNCW2eu"
    } ],
    "available_markets": [ "AD", "AR", "AT", "AU", "BE", "BG", "BO", "BR", "CH", "CL", "CO", "CR", "CY", "CZ", "DE", "DK", "DO", "EC", "EE", "ES", "FI", "FR", "GR", "GT", "HK", "HN", "HU", "IE", "IS", "IT", "LI", "LT", "LU", "LV", "MC", "MT", "MY", "NI", "NL", "NO", "NZ", "PA", "PE", "PH", "PL", "PT", "PY", "RO", "SE", "SG", "SI", "SK", "SV", "TR", "TW", "UY" ],
    "disc_number": 1,
    "duration_ms": 222075,
    "explicit": false,
    "external_ids": {
      "isrc": "USIR20400274"
    },
    "external_urls": {
      "spotify": "https://open.spotify.com/track/0eGsygTp906u18L0Oimnem"
    },
    "href": "https://api.spotify.com/v1/tracks/0eGsygTp906u18L0Oimnem",
    "id": "0eGsygTp906u18L0Oimnem",
    "name": "Mr. Brightside",
    "popularity": 0,
    "preview_url": "http://d318706lgtcm8e.cloudfront.net/mp3-preview/f454c8224828e21fa146af84916fd22cb89cedc6",
    "track_number": 2,
    "type": "track",
    "uri": "spotify:track:0eGsygTp906u18L0Oimnem"
  }, {
    "album": {
      "album_type": "album",
      "external_urls": {
        "spotify": "https://open.spotify.com/album/6TJmQnO44YE5BtTxH8pop1"
      },
      "href": "https://api.spotify.com/v1/albums/6TJmQnO44YE5BtTxH8pop1",
      "id": "6TJmQnO44YE5BtTxH8pop1",
      "images": [ {
        "height": 640,
        "url": "https://d3rt1990lpmkn.cloudfront.net/original/8e13218039f81b000553e25522a7f0d7a0600f2e",
        "width": 629
      }, {
        "height": 300,
        "url": "https://d3rt1990lpmkn.cloudfront.net/original/8c1e066b5d1045038437d92815d49987f519e44f",
        "width": 295
      }, {
        "height": 64,
        "url": "https://d3rt1990lpmkn.cloudfront.net/original/d49268a8fc0768084f4750cf1647709e89a27172",
        "width": 63
      } ],
      "name": "Hot Fuss",
      "type": "album",
      "uri": "spotify:album:6TJmQnO44YE5BtTxH8pop1"
    },
    "artists": [ {
      "external_urls": {
        "spotify": "https://open.spotify.com/artist/0C0XlULifJtAgn6ZNCW2eu"
      },
      "href": "https://api.spotify.com/v1/artists/0C0XlULifJtAgn6ZNCW2eu",
      "id": "0C0XlULifJtAgn6ZNCW2eu",
      "name": "The Killers",
      "type": "artist",
      "uri": "spotify:artist:0C0XlULifJtAgn6ZNCW2eu"
    } ],
    "available_markets": [ "AD", "AR", "AT", "AU", "BE", "BG", "BO", "BR", "CH", "CL", "CO", "CR", "CY", "CZ", "DE", "DK", "DO", "EC", "EE", "ES", "FI", "FR", "GR", "GT", "HK", "HN", "HU", "IE", "IS", "IT", "LI", "LT", "LU", "LV", "MC", "MT", "MY", "NI", "NL", "NO", "NZ", "PA", "PE", "PH", "PL", "PT", "PY", "RO", "SE", "SG", "SI", "SK", "SV", "TR", "TW", "UY" ],
    "disc_number": 1,
    "duration_ms": 197160,
    "explicit": false,
    "external_ids": {
      "isrc": "USIR20400195"
    },
    "external_urls": {
      "spotify": "https://open.spotify.com/track/1lDWb6b6ieDQ2xT7ewTC3G"
    },
    "href": "https://api.spotify.com/v1/tracks/1lDWb6b6ieDQ2xT7ewTC3G",
    "id": "1lDWb6b6ieDQ2xT7ewTC3G",
    "name": "Somebody Told Me",
    "popularity": 0,
    "preview_url": "http://d318706lgtcm8e.cloudfront.net/mp3-preview/4c63a3d4eaf7f8f86cfdb8bf46ef3974f4092357",
    "track_number": 4,
    "type": "track",
    "uri": "spotify:track:1lDWb6b6ieDQ2xT7ewTC3G"
  } ]
}

var author = {
 "display_name" : "Lilla Namo",
 "external_urls" : {
 "spotify" : "https://open.spotify.com/user/tuggareutangranser"
 },
 "followers" : {
 "href" : null,
 "total" : 4561
 },
 "href" : "https://api.spotify.com/v1/users/tuggareutangranser",
 "id" : "tuggareutangranser",
 "images" : [ {
 "height" : null,
 "url" : "http://profile-images.scdn.co/artists/default/d4f208d4d49c6f3e1363765597d10c4277f5b74f",
 "width" : null
 } ],
 "type" : "user",
 "uri" : "spotify:user:tuggareutangranser"
}

var Track = React.createClass({

	render: function(){
		return (
			<tr>
				<td>{this.props.name}</td>
				<td>{this.props.artist}</td>		
				<td>{this.props.album}</td>
			</tr>
		)
	}
});

var Playlist = React.createClass({
	getInitialState: function(){
		// access_token = "BQB3MEuAGTr9IoyP3SWFGUacE2uhKvHjkXy9k-ByZ_ZVuuiNGYRWV_iSosd74hB3jbbn_0HJHTzqBw-wZ5zjhITh5kRuDfFqWqp5YjxCR6b2tyMXqAzb-9vLE1Y0CH8JTfGGncwgFHQ0l06hlo9Y98mJBgRg5ag4wGcY5sq4RjS1ebJSZLQpzVAR6i9o4a5JobrL2YdzGq9Ksbk";
		// var author;
		// var collaborators = [];
		// playlist.collaborators.map(function (collaborator) {
		// 	$.get('https://api.spotify.com/v1/users/'+collaborator,
		// 		{ headers: {'Authorization': 'Bearer ' + access_token} },
		// 		function(result){
		// 			var user = result;
		// 			collaborators.push(user);
		// 			if(collaborator == playlist.created_by){
		// 				author = user;
		// 			}
		// 	},

		// 	);
		// })

		// var tracks = [];
		// $.get('https://api.spotify.com/v1/tracks?ids='+playlist.tracks.slice(0, 50).join(),
		// 	{ headers: {'Authorization': 'Bearer ' + access_token} },
		// 	function(result){
		// 		tracks = result;
		// 	});

		// console.log(author);
		console.log(tracks.tracks);
		var author_name = author.display_name ? author.display_name : author.id;

		return {
			playlist: playlist,
			author: author_name,
			//collaborators: collaborators,
			tracks: tracks.tracks
		}
	},
	render: function(){
		var count = 0;
		return (
			<div className="container">
				<div className="inline">
					<img src={this.state.playlist.thumb}/>
				</div>
				<div className="inline">
					<h2>{this.state.playlist.title}</h2>
					<p>By <a href={"/user/" + this.state.playlist.created_by}>
						{this.state.author}
					</a></p>
				</div>
				<div>
					<a href={"/playlist/" + this.state.playlist.id + "/fork"} className="btn btn-primary">Fork</a>
					<a href={"/playlist/" + this.state.playlist.id + "/history"} className="btn btn-primary">Fork History</a>
					<a href={"/playlist/" + this.state.playlist.id + "/diffs"} className="btn btn-primary">Diffs</a>
				</div>
				<iframe src={
						"https://embed.spotify.com/?uri=spotify:trackset:"
						+ this.state.playlist.title
						+ ":"
						+ this.state.playlist.tracks.join()
					}
					frameborder="0"
					allowtransparency="true"
					width="250" height="80">
				</iframe>
				<table className="table">
					<tr>
						<th>Track</th>
						<th>Artist</th>		
						<th>Album</th>
					</tr>
					{this.state.tracks.map(function (track){
						return(
							<Track name={track.name} artist={track.artists[0].name} album={track.album.name} />
					)})}
				</table>
			</div>
		)
	}
})

React.render(<Playlist playlist={playlist}></Playlist>, document.body);