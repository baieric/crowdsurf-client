// temp hardcoded playlist
var playlist = {
	"id": 1,
	// "created_by": "wizzler",
	"title": "Awesome playlist",
	"thumb": "some.jpg",
	"timestamp": 1234567890,
	"parent": 34,
	"tags": ["rock", "pop", "electronic"],
	"collaborators": ["wizzler", "efaulte"],
	"tracks": ["5Z7ygHQo02SUrFmcgpwsKW", "1x6ACsKV4UdWS2FMuPFUiT", "4bi73jCM02fMpkI11Lqmfe"]
}

var tracks = {
  "tracks": [ {
    "album": {
      "album_type": "album",
      "external_urls": {
        "spotify": "https://open.spotify.com/album/6TJmQnO44YE5BtTxH8pop1"
      },
      "href": "https://api.spotify.com/v1/albums/6TJmQnO44YE5BtTxH8pop1",
      "id": "6TJmQnO44YE5BtTxH8pop1",
      "images": [ {
        "height": 640,
        "url": "https://d3rt1990lpmkn.cloudfront.net/original/8e13218039f81b000553e25522a7f0d7a0600f2e",
        "width": 629
      }, {
        "height": 300,
        "url": "https://d3rt1990lpmkn.cloudfront.net/original/8c1e066b5d1045038437d92815d49987f519e44f",
        "width": 295
      }, {
        "height": 64,
        "url": "https://d3rt1990lpmkn.cloudfront.net/original/d49268a8fc0768084f4750cf1647709e89a27172",
        "width": 63
      } ],
      "name": "Hot Fuss",
      "type": "album",
      "uri": "spotify:album:6TJmQnO44YE5BtTxH8pop1"
    },
    "artists": [ {
      "external_urls": {
        "spotify": "https://open.spotify.com/artist/0C0XlULifJtAgn6ZNCW2eu"
      },
      "href": "https://api.spotify.com/v1/artists/0C0XlULifJtAgn6ZNCW2eu",
      "id": "0C0XlULifJtAgn6ZNCW2eu",
      "name": "The Killers",
      "type": "artist",
      "uri": "spotify:artist:0C0XlULifJtAgn6ZNCW2eu"
    } ],
    "available_markets": [ "AD", "AR", "AT", "AU", "BE", "BG", "BO", "BR", "CH", "CL", "CO", "CR", "CY", "CZ", "DE", "DK", "DO", "EC", "EE", "ES", "FI", "FR", "GR", "GT", "HK", "HN", "HU", "IE", "IS", "IT", "LI", "LT", "LU", "LV", "MC", "MT", "MY", "NI", "NL", "NO", "NZ", "PA", "PE", "PH", "PL", "PT", "PY", "RO", "SE", "SG", "SI", "SK", "SV", "TR", "TW", "UY" ],
    "disc_number": 1,
    "duration_ms": 222075,
    "explicit": false,
    "external_ids": {
      "isrc": "USIR20400274"
    },
    "external_urls": {
      "spotify": "https://open.spotify.com/track/0eGsygTp906u18L0Oimnem"
    },
    "href": "https://api.spotify.com/v1/tracks/0eGsygTp906u18L0Oimnem",
    "id": "0eGsygTp906u18L0Oimnem",
    "name": "Mr. Brightside",
    "popularity": 0,
    "preview_url": "http://d318706lgtcm8e.cloudfront.net/mp3-preview/f454c8224828e21fa146af84916fd22cb89cedc6",
    "track_number": 2,
    "type": "track",
    "uri": "spotify:track:0eGsygTp906u18L0Oimnem"
  }, {
    "album": {
      "album_type": "album",
      "external_urls": {
        "spotify": "https://open.spotify.com/album/6TJmQnO44YE5BtTxH8pop1"
      },
      "href": "https://api.spotify.com/v1/albums/6TJmQnO44YE5BtTxH8pop1",
      "id": "6TJmQnO44YE5BtTxH8pop1",
      "images": [ {
        "height": 640,
        "url": "https://d3rt1990lpmkn.cloudfront.net/original/8e13218039f81b000553e25522a7f0d7a0600f2e",
        "width": 629
      }, {
        "height": 300,
        "url": "https://d3rt1990lpmkn.cloudfront.net/original/8c1e066b5d1045038437d92815d49987f519e44f",
        "width": 295
      }, {
        "height": 64,
        "url": "https://d3rt1990lpmkn.cloudfront.net/original/d49268a8fc0768084f4750cf1647709e89a27172",
        "width": 63
      } ],
      "name": "Hot Fuss",
      "type": "album",
      "uri": "spotify:album:6TJmQnO44YE5BtTxH8pop1"
    },
    "artists": [ {
      "external_urls": {
        "spotify": "https://open.spotify.com/artist/0C0XlULifJtAgn6ZNCW2eu"
      },
      "href": "https://api.spotify.com/v1/artists/0C0XlULifJtAgn6ZNCW2eu",
      "id": "0C0XlULifJtAgn6ZNCW2eu",
      "name": "The Killers",
      "type": "artist",
      "uri": "spotify:artist:0C0XlULifJtAgn6ZNCW2eu"
    } ],
    "available_markets": [ "AD", "AR", "AT", "AU", "BE", "BG", "BO", "BR", "CH", "CL", "CO", "CR", "CY", "CZ", "DE", "DK", "DO", "EC", "EE", "ES", "FI", "FR", "GR", "GT", "HK", "HN", "HU", "IE", "IS", "IT", "LI", "LT", "LU", "LV", "MC", "MT", "MY", "NI", "NL", "NO", "NZ", "PA", "PE", "PH", "PL", "PT", "PY", "RO", "SE", "SG", "SI", "SK", "SV", "TR", "TW", "UY" ],
    "disc_number": 1,
    "duration_ms": 197160,
    "explicit": false,
    "external_ids": {
      "isrc": "USIR20400195"
    },
    "external_urls": {
      "spotify": "https://open.spotify.com/track/1lDWb6b6ieDQ2xT7ewTC3G"
    },
    "href": "https://api.spotify.com/v1/tracks/1lDWb6b6ieDQ2xT7ewTC3G",
    "id": "1lDWb6b6ieDQ2xT7ewTC3G",
    "name": "Somebody Told Me",
    "popularity": 0,
    "preview_url": "http://d318706lgtcm8e.cloudfront.net/mp3-preview/4c63a3d4eaf7f8f86cfdb8bf46ef3974f4092357",
    "track_number": 4,
    "type": "track",
    "uri": "spotify:track:1lDWb6b6ieDQ2xT7ewTC3G"
  } ]
}

var authors = [{
 "display_name" : "Lilla Namo",
 "external_urls" : {
 "spotify" : "https://open.spotify.com/user/tuggareutangranser"
 },
 "followers" : {
 "href" : null,
 "total" : 4561
 },
 "href" : "https://api.spotify.com/v1/users/tuggareutangranser",
 "id" : "tuggareutangranser",
 "images" : [ {
 "height" : null,
 "url" : "http://profile-images.scdn.co/artists/default/d4f208d4d49c6f3e1363765597d10c4277f5b74f",
 "width" : null
 } ],
 "type" : "user",
 "uri" : "spotify:user:tuggareutangranser"
},
{
 "display_name" : null,
 "external_urls" : {
 "spotify" : "https://open.spotify.com/user/tuggareutangranser"
 },
 "followers" : {
 "href" : null,
 "total" : 4561
 },
 "href" : "https://api.spotify.com/v1/users/tuggareutangranser",
 "id" : "tuggareutangranser",
 "images" : [ {
 "height" : null,
 "url" : "http://profile-images.scdn.co/artists/default/d4f208d4d49c6f3e1363765597d10c4277f5b74f",
 "width" : null
 } ],
 "type" : "user",
 "uri" : "spotify:user:tuggareutangranser"
},
]

var current_user = "efaulte"

// end of temp stuff

var Track = React.createClass({

	render: function(){
		return (
			<tr>
				<td>{this.props.name}</td>
				<td>{this.props.artist}</td>		
				<td>{this.props.album}</td>
			</tr>
		)
	}
});

var Author = React.createClass({
  render: function(){
    return(
      <a href={"/user/" + this.props.id}>{this.props.name}</a>
    )
  }
});

var Playlist = React.createClass({
	getInitialState: function(){
		console.log(tracks.tracks);
    var authorInfos = [];
    var isOwner = false;
    for (var i = authors.length - 1; i >= 0; i--) {
      var name = authors[i].display_name ? authors[i].display_name : authors[i].id;
      var author_info = { "display_name": name, "id": authors[i].id };
      authorInfos.push(author_info);
      if(playlist.collaborators[i] == current_user){
        isOwner = true;
      }
    };

    console.log(authorInfos);

    var editUrl;
    var editLabel;

    if(isOwner){
      editLabel = "Edit";
      editUrl = "/playlist/" + playlist.id + "/edit";
    }else{
      editLabel = "Fork This Playlist";
      editUrl = "/playlist/" + playlist.id + "/fork";
    }

    var parentLabel;
    var parentUrl;
    if(playlist.parent == null){
      parentLabel = "";
      parentUrl = "";
    }else{
      parentLabel = "Forked from " + playlist.parent;
      parentUrl = "/playlists/" + playlist.parent;
    }

		return {
			playlist: playlist,
			authorInfos: authorInfos,
			tracks: tracks.tracks,
      editLabel: editLabel,
      editUrl: editUrl,
      parentLabel: parentLabel,
      parentUrl: parentUrl
		}
	},
	render: function(){
		return (
      <div>
      <div id="navbar" className="collapse navbar-collapse">
            <ul className="nav navbar-nav">
              <li className="active"><a href="#">Home</a></li>
              <li><a href="#create">Create Playlist</a></li>
            </ul>
          </div>
			<div className="container">
				<div className="inline">
					<img src={this.state.playlist.thumb}/>
				</div>
				<div className="inline">
					<h2>{this.state.playlist.title}</h2>
          <a href={this.state.parentUrl}>{this.state.parentLabel}</a>
					<p>By 
          {this.state.authorInfos.map(function (author){
            return(
              <span> <Author name={author.display_name} id={author.id} />, </span>
          )})}
          </p>
				</div>
				<div>
					<a href={this.state.editUrl} className="btn btn-primary">{this.state.editLabel}</a>
					<a href={"/playlist/" + this.state.playlist.id + "/forks"} className="btn btn-primary">Forks</a>
					<a href={"/playlist/" + this.state.playlist.id + "/history"} className="btn btn-primary">History</a>
				</div>
				<iframe src={
						"https://embed.spotify.com/?uri=spotify:trackset:"
						+ this.state.playlist.title
						+ ":"
						+ this.state.playlist.tracks.join()
					}
					frameborder="0"
					allowtransparency="true"
					width="250" height="80">
				</iframe>
				<table className="table">
					<tr>
						<th>Track</th>
						<th>Artist</th>		
						<th>Album</th>
					</tr>
					{this.state.tracks.map(function (track){
						return(
							<Track name={track.name} artist={track.artists[0].name} album={track.album.name} />
					)})}
				</table>
			</div>
      </div>
		)
	}
})

React.render(<Playlist playlist={playlist}></Playlist>, document.body);